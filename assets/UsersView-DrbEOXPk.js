import{r as d,u as v,R as l,U as N,j as e,B as C,a as S}from"./index-Dh2HMBa2.js";import{C as w}from"./Dashboard-CFLZ1FYc.js";const R=({isOpen:o,onClose:x,onSuccess:f,user:i})=>{const[s,c]=d.useState(null),[b,m]=d.useState({}),[t,u]=d.useState(!1),{user:n}=v();d.useEffect(()=>{i&&c({...i}),o||m({})},[i,o]);const y=d.useMemo(()=>(n==null?void 0:n.role)===l.Manager?N.filter(a=>a!==l.Admin):N,[n]),g=()=>{if(!s)return!1;const a={};return s.name.trim()||(a.name="El nombre es obligatorio."),m(a),Object.keys(a).length===0},r=a=>{const{name:p,value:E}=a.target;s&&c(k=>({...k,[p]:E}))},j=async a=>{if(a.preventDefault(),!(!s||!g())){u(!0);try{const p=await S.updateUser(s);f(p),x()}catch(p){console.error("Failed to update user",p)}finally{u(!1)}}};if(!o||!s)return null;const h=(n==null?void 0:n.role)===l.Admin;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60","aria-modal":"true",role:"dialog",children:e.jsx("div",{className:"bg-brand-surface border border-brand-border rounded-lg shadow-xl w-full max-w-md m-4",children:e.jsxs("form",{onSubmit:j,children:[e.jsx("div",{className:"p-6 border-b border-brand-border",children:e.jsx("h2",{className:"text-2xl font-bold text-brand-text-primary",children:"Editar Usuario"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-brand-text-secondary",children:"Nombre Completo"}),e.jsx("input",{type:"text",name:"name",id:"name",value:s.name,onChange:r,className:`mt-1 block w-full bg-brand-bg border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary ${b.name?"border-red-500":"border-brand-border"}`}),b.name&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:b.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-brand-text-secondary",children:"Email"}),e.jsx("input",{type:"email",name:"email",id:"email",value:s.email,disabled:!0,className:"mt-1 block w-full border border-brand-border rounded-md shadow-sm p-2 bg-gray-700 cursor-not-allowed text-brand-text-muted"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"branch",className:"block text-sm font-medium text-brand-text-secondary",children:"Sucursal"}),e.jsx("select",{name:"branch",id:"branch",value:s.branch,onChange:r,disabled:!h,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary disabled:bg-gray-700 disabled:cursor-not-allowed",children:C.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-brand-text-secondary",children:"Rol"}),e.jsx("select",{name:"role",id:"role",value:s.role,onChange:r,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 capitalize text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary",children:y.map(a=>e.jsx("option",{value:a,className:"capitalize",children:a},a))})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-black/20 border-t border-brand-border flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 text-sm font-medium text-brand-text-primary bg-brand-border border border-transparent rounded-md shadow-sm hover:bg-gray-600",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:t,className:"px-4 py-2 text-sm font-medium text-white bg-brand-primary border border-transparent rounded-md shadow-sm hover:bg-brand-primary-hover disabled:opacity-50",children:t?"Guardando...":"Guardar Cambios"})]})]})})})},A={[l.Admin]:"bg-yellow-400/20 text-yellow-300",[l.Manager]:"bg-red-900/60 text-red-200",[l.Seller]:"bg-blue-900/60 text-blue-200",[l.Viewer]:"bg-gray-700 text-gray-200"},O=()=>{const[o,x]=d.useState([]),[f,i]=d.useState(!0),[s,c]=d.useState(!1),[b,m]=d.useState(null),{user:t}=v(),u=d.useCallback(async()=>{i(!0);try{const r=await S.getUsers();x(r)}catch(r){console.error("Failed to fetch users",r)}finally{i(!1)}},[]);d.useEffect(()=>{u()},[u]);const n=d.useMemo(()=>t?t.role===l.Admin?o:t.role===l.Manager?o.filter(r=>r.branch===t.branch&&r.role!==l.Admin):[]:[],[o,t]),y=r=>{x(j=>j.map(h=>h.id===r.id?r:h)),c(!1),m(null)},g=r=>{m(r),c(!0)};return f?e.jsx(w,{children:"Cargando usuarios..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-brand-text-primary",children:"GestiÃ³n de Usuarios"}),e.jsx("p",{className:"text-brand-text-secondary",children:(t==null?void 0:t.role)===l.Admin?"Gestiona usuarios de todas las sucursales.":`Gestiona usuarios de la sucursal ${t==null?void 0:t.branch}.`})]}),e.jsx(w,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-brand-border",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider",children:"Sucursal"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider",children:"Rol"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Acciones"})})]})}),e.jsx("tbody",{className:"bg-brand-surface divide-y divide-brand-border",children:n.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-brand-text-primary",children:r.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-brand-text-secondary",children:r.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-brand-text-secondary",children:r.branch}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize ${A[r.role]||"bg-gray-700 text-gray-200"}`,children:r.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-4",children:e.jsx("button",{onClick:()=>g(r),className:"font-medium text-brand-primary hover:text-brand-primary-hover",children:"Editar"})})]},r.id))})]})})}),e.jsx(R,{isOpen:s,onClose:()=>{c(!1),m(null)},onSuccess:y,user:b})]})};export{O as default};
