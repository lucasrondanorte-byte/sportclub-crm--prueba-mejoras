const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ImportGoogleSheetModal-Dt4lVu6k.js","assets/index-Dh2HMBa2.js"])))=>i.map(i=>d[i]);
import{u as K,r as n,P as H,e as se,f as Q,R as c,j as e,h as ne,a as B,i as U,k as pe,M as ge,l as h,m as ce,_ as fe}from"./index-Dh2HMBa2.js";import{C as ae}from"./Dashboard-CFLZ1FYc.js";const ue=()=>{const p=new Date;return p.setDate(p.getDate()+1),p.toISOString().split("T")[0]},me={name:"",phone:"",email:"",source:Q[0],interest:se[0],stage:H.New,assignedTo:"",dni:"",address:"",notes:"",nextActionDate:ue()},ye=({isOpen:p,onClose:T,onSuccess:A,sellers:M})=>{const{user:l}=K(),[s,r]=n.useState(me),[x,u]=n.useState({}),[R,f]=n.useState(!1);n.useEffect(()=>{(l==null?void 0:l.role)===c.Seller&&r(o=>({...o,assignedTo:l.id})),p||(r({...me,nextActionDate:ue()}),u({}))},[p,l]);const F=()=>{const o={};return s.name.trim()||(o.name="El nombre es obligatorio."),s.email.trim()?/\S+@\S+\.\S+/.test(s.email)||(o.email="El formato del email es inválido."):o.email="El email es obligatorio.",s.assignedTo||(o.assignedTo="Debe asignar un vendedor."),u(o),Object.keys(o).length===0},m=o=>{const{name:y,value:C}=o.target;r(E=>({...E,[y]:C}))},P=async o=>{if(o.preventDefault(),!!F()){f(!0);try{const y={...s,createdBy:l.id,updatedBy:l.id,nextActionDate:s.nextActionDate?new Date(s.nextActionDate).toISOString():null},C=await B.addProspect(y);s.notes.trim()&&await B.addInteraction({relatedTo:C.id,doneBy:l.id,type:U.Note,summary:s.notes,result:"Nota inicial creada con el prospecto."}),A(C)}catch(y){console.error("Failed to add prospect or initial interaction",y)}finally{f(!1)}}};return p?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60","aria-modal":"true",role:"dialog",children:e.jsx("div",{className:"bg-brand-surface border border-brand-border rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4",children:e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"p-6 border-b border-brand-border",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-text-primary",children:"Agregar Nuevo Prospecto"}),e.jsx("p",{className:"text-sm text-brand-text-secondary",children:"Complete los detalles a continuación."})]}),e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-brand-text-secondary",children:"Nombre Completo"}),e.jsx("input",{type:"text",name:"name",id:"name",value:s.name,onChange:m,className:`mt-1 block w-full bg-brand-bg border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary ${x.name?"border-red-500":"border-brand-border"}`}),x.name&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:x.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-brand-text-secondary",children:"Email"}),e.jsx("input",{type:"email",name:"email",id:"email",value:s.email,onChange:m,className:`mt-1 block w-full bg-brand-bg border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary ${x.email?"border-red-500":"border-brand-border"}`}),x.email&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:x.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-brand-text-secondary",children:"Teléfono"}),e.jsx("input",{type:"tel",name:"phone",id:"phone",value:s.phone,onChange:m,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-brand-text-secondary",children:"Origen"}),e.jsx("select",{name:"source",id:"source",value:s.source,onChange:m,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary",children:Q.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"interest",className:"block text-sm font-medium text-brand-text-secondary",children:"Interés"}),e.jsx("select",{name:"interest",id:"interest",value:s.interest,onChange:m,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary",children:se.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nextActionDate",className:"block text-sm font-medium text-brand-text-secondary",children:"Próxima Acción"}),e.jsx("input",{type:"date",name:"nextActionDate",id:"nextActionDate",value:s.nextActionDate,onChange:m,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stage",className:"block text-sm font-medium text-brand-text-secondary",children:"Etapa"}),e.jsx("select",{name:"stage",id:"stage",value:s.stage,onChange:m,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary",children:ne.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"assignedTo",className:"block text-sm font-medium text-brand-text-secondary",children:"Vendedor Asignado"}),e.jsxs("select",{name:"assignedTo",id:"assignedTo",value:s.assignedTo,onChange:m,disabled:(l==null?void 0:l.role)===c.Seller,className:`mt-1 block w-full bg-brand-bg border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary ${x.assignedTo?"border-red-500":"border-brand-border"} ${(l==null?void 0:l.role)===c.Seller?"bg-gray-700":""}`,children:[e.jsx("option",{value:"",children:"Seleccionar vendedor..."}),M.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]}),x.assignedTo&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:x.assignedTo})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dni",className:"block text-sm font-medium text-brand-text-secondary",children:"DNI (Sensible)"}),e.jsx("input",{type:"text",name:"dni",id:"dni",value:s.dni,onChange:m,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-brand-text-secondary",children:"Dirección (Sensible)"}),e.jsx("input",{type:"text",name:"address",id:"address",value:s.address,onChange:m,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-brand-text-secondary",children:"Notas (Sensible)"}),e.jsx("textarea",{name:"notes",id:"notes",value:s.notes,onChange:m,rows:3,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-black/20 border-t border-brand-border flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:T,className:"px-4 py-2 text-sm font-medium text-brand-text-primary bg-brand-border border border-transparent rounded-md shadow-sm hover:bg-gray-600",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:R,className:"px-4 py-2 text-sm font-medium text-white bg-brand-primary border border-transparent rounded-md shadow-sm hover:bg-brand-primary-hover disabled:opacity-50",children:R?"Guardando...":"Guardar Prospecto"})]})]})})}):null},je=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),e.jsx("path",{fillRule:"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z",clipRule:"evenodd"})]}),ve=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})}),we=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"}),e.jsx("path",{d:"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"})]}),Ne=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10c0 3.866-3.582 7-8 7a8.834 8.834 0 01-4.195-1.125l-2.665.89c-.337.112-.718-.268-.606-.605l.89-2.665A8.834 8.834 0 012 10C2 6.134 5.582 3 10 3s8 3.134 8 7zM7 9a1 1 0 100-2 1 1 0 000 2zm4 0a1 1 0 100-2 1 1 0 000 2zm4 0a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),Se=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),be={[U.Note]:e.jsx(je,{}),[U.Call]:e.jsx(ve,{}),[U.Email]:e.jsx(we,{}),[U.WhatsApp]:e.jsx(Ne,{}),[U.Visit]:e.jsx(Se,{})},ke={[h.NotReported]:{fee:0,durationMonths:0},[h.Flex]:{fee:7e3,durationMonths:1},[h.FlexAnual1Pago]:{fee:7e4,durationMonths:12},[h.FlexUsoPlus]:{fee:8500,durationMonths:1},[h.FlexUsoTotal]:{fee:1e4,durationMonths:1},[h.Plus]:{fee:8500,durationMonths:1},[h.PlusAnual1Pago]:{fee:84e3,durationMonths:12},[h.PlusAnual3Cuotas]:{fee:92400,durationMonths:12},[h.PlusAnual6Cuotas]:{fee:92400,durationMonths:12},[h.Total]:{fee:1e4,durationMonths:1},[h.TotalAnual1Pago]:{fee:98e3,durationMonths:12},[h.TotalAnual3Cuotas]:{fee:107800,durationMonths:12},[h.TotalAnual6Cuotas]:{fee:107800,durationMonths:12},[h.TotalSemestral1Pago]:{fee:54e3,durationMonths:6},[h.TotalSemestral6Cuotas]:{fee:59400,durationMonths:6},[h.Local]:{fee:7e3,durationMonths:1},[h.LocalTrimestral1Pago]:{fee:2e4,durationMonths:3},[h.LocalSemestral1Pago]:{fee:39e3,durationMonths:6},[h.LocalSemestral6Cuotas]:{fee:42900,durationMonths:6},[h.LocalAnnual1Pago]:{fee:7e4,durationMonths:12},[h.LocalAnnual3Cuotas]:{fee:77e3,durationMonths:12},[h.LocalAnnual6Cuotas]:{fee:77e3,durationMonths:12},[h.ACAPlus]:{fee:8500,durationMonths:1},[h.ACATOTAL]:{fee:1e4,durationMonths:1}},Ce=p=>ke[p]||{fee:7e3,durationMonths:1},Ae=({isOpen:p,onClose:T,onSuccess:A,users:M,prospect:l})=>{var G;const{user:s}=K(),[r,x]=n.useState(null),[u,R]=n.useState({}),[f,F]=n.useState(!1),[m,P]=n.useState([]),[o,y]=n.useState({type:U.Note,summary:""}),[C,E]=n.useState(!1);s==null||s.role,c.Seller,n.useEffect(()=>{l?(x({...l}),B.getInteractionsByProspectId(l.id).then(a=>{P(a.sort((N,D)=>new Date(D.date).getTime()-new Date(N.date).getTime()))})):(x(null),P([]))},[l,p]);const V=n.useMemo(()=>new Map(M.map(a=>[a.id,a.name])),[M]),i=n.useMemo(()=>(s==null?void 0:s.role)===c.Admin?M.filter(a=>a.role===c.Seller||a.role===c.Manager):s?M.filter(a=>a.branch===s.branch&&(a.role===c.Seller||a.role===c.Manager)):[],[M,s]),w=()=>{if(!r)return!1;const a={};return r.name.trim()||(a.name="El nombre es obligatorio."),r.email.trim()?/\S+@\S+\.\S+/.test(r.email)||(a.email="El formato del email es inválido."):a.email="El email es obligatorio.",r.assignedTo||(a.assignedTo="Debe asignar un vendedor."),R(a),Object.keys(a).length===0},g=a=>{if(!r)return;const{name:N,value:D}=a.target;x(L=>L?{...L,[N]:D}:null)},O=async()=>{if(!(!r||!w())){F(!0);try{const a={...r,updatedBy:s.id,nextActionDate:r.nextActionDate?new Date(r.nextActionDate).toISOString():null},N=await B.updateProspect(a);A(N)}catch(a){console.error("Failed to update prospect",a)}finally{F(!1)}}},W=async()=>{if(!(!o.summary.trim()||!l||!s)){E(!0);try{const a=await B.addInteraction({relatedTo:l.id,doneBy:s.id,type:o.type,summary:o.summary,result:""});P(N=>[a,...N]),y({type:U.Note,summary:""})}catch(a){console.error("Failed to add interaction",a)}finally{E(!1)}}},$=async()=>{if(!(!r||!s)){F(!0);try{const a=Ce(r.interest),N=new Date,D=new Date;D.setMonth(D.getMonth()+a.durationMonths),await B.addMember({name:r.name,plan:r.interest,fee:a.fee,status:ge.Active,startDate:N.toISOString(),endDate:D.toISOString(),originalSeller:r.assignedTo,dni:r.dni,address:r.address,notes:`Convertido desde prospecto. Notas originales: ${r.notes}`});const L=await B.updateProspect({...r,stage:H.Won,updatedBy:s.id});A(L),T()}catch(a){console.error("Failed to convert prospect to member",a)}finally{F(!1)}}};if(!p||!r)return null;const Z=(s==null?void 0:s.role)===c.Admin||(s==null?void 0:s.role)===c.Manager,_=![H.Won,H.Lost].includes(r.stage);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"bg-brand-surface border border-brand-border rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] flex flex-col m-4",children:[e.jsxs("div",{className:"p-5 border-b border-brand-border flex justify-between items-center",children:[e.jsxs("h2",{className:"text-2xl font-bold text-brand-text-primary",children:["Editar Prospecto: ",e.jsx("span",{className:"text-brand-primary",children:r.name})]}),e.jsx("button",{onClick:T,className:"text-gray-400 hover:text-gray-600 text-3xl font-bold",children:"×"})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 overflow-hidden",children:[e.jsxs("div",{className:"p-6 overflow-y-auto space-y-4 border-r border-brand-border",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-text-primary border-b border-brand-border pb-2",children:"Detalles"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-brand-text-secondary",children:"Nombre"}),e.jsx("input",{type:"text",name:"name",id:"name",value:r.name,onChange:g,className:`mt-1 block w-full bg-brand-bg border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary ${u.name?"border-red-500":"border-brand-border"}`}),u.name&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:u.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-brand-text-secondary",children:"Email"}),e.jsx("input",{type:"email",name:"email",id:"email",value:r.email,onChange:g,className:`mt-1 block w-full bg-brand-bg border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary ${u.email?"border-red-500":"border-brand-border"}`}),u.email&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:u.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-brand-text-secondary",children:"Teléfono"}),e.jsx("input",{type:"tel",name:"phone",id:"phone",value:r.phone,onChange:g,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stage",className:"block text-sm font-medium text-brand-text-secondary",children:"Etapa"}),e.jsx("select",{name:"stage",id:"stage",value:r.stage,onChange:g,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary",children:ne.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-brand-text-secondary",children:"Origen"}),e.jsx("select",{name:"source",id:"source",value:r.source,onChange:g,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary",children:Q.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"interest",className:"block text-sm font-medium text-brand-text-secondary",children:"Interés"}),e.jsx("select",{name:"interest",id:"interest",value:r.interest,onChange:g,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary",children:se.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nextActionDate",className:"block text-sm font-medium text-brand-text-secondary",children:"Próxima Acción"}),e.jsx("input",{type:"date",name:"nextActionDate",id:"nextActionDate",value:((G=r.nextActionDate)==null?void 0:G.split("T")[0])||"",onChange:g,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"assignedTo",className:"block text-sm font-medium text-brand-text-secondary",children:"Vendedor Asignado"}),e.jsxs("select",{name:"assignedTo",id:"assignedTo",value:r.assignedTo,onChange:g,disabled:!Z,className:`mt-1 block w-full bg-brand-bg border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary disabled:bg-gray-700 ${u.assignedTo?"border-red-500":"border-brand-border"}`,children:[e.jsx("option",{value:"",children:"Seleccionar vendedor..."}),i.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),u.assignedTo&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:u.assignedTo})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dni",className:"block text-sm font-medium text-brand-text-secondary",children:"DNI (Sensible)"}),e.jsx("input",{type:"text",name:"dni",id:"dni",value:r.dni,onChange:g,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-brand-text-secondary",children:"Dirección (Sensible)"}),e.jsx("input",{type:"text",name:"address",id:"address",value:r.address,onChange:g,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-brand-text-secondary",children:"Notas (Sensible)"}),e.jsx("textarea",{name:"notes",id:"notes",value:r.notes,onChange:g,rows:2,className:"mt-1 block w-full bg-brand-bg border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"})]})]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex flex-col",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-text-primary border-b border-brand-border pb-2 mb-4",children:"Interacciones"}),e.jsxs("div",{className:"bg-brand-bg/50 p-4 border border-brand-border rounded-lg mb-4",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-2",children:pe.map(a=>e.jsxs("button",{type:"button",onClick:()=>y(N=>({...N,type:a})),className:`p-2 rounded-md flex items-center justify-center gap-2 text-sm transition-colors capitalize ${o.type===a?"bg-brand-primary text-white":"bg-brand-border hover:bg-gray-600"}`,children:[be[a]," ",a]},a))}),e.jsx("textarea",{value:o.summary,onChange:a=>y(N=>({...N,summary:a.target.value})),placeholder:"Escribe un resumen de la interacción...",rows:3,className:"w-full bg-brand-bg border border-brand-border rounded-md p-2 text-sm text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary"}),e.jsx("button",{onClick:W,disabled:C,className:"w-full mt-2 px-4 py-2 text-sm font-medium text-white bg-brand-primary rounded-md hover:bg-brand-primary-hover disabled:opacity-50",children:C?"Agregando...":"Agregar Interacción"})]}),e.jsxs("div",{className:"flex-1 space-y-3 overflow-y-auto pr-2",children:[m.map(a=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center bg-gray-700 text-brand-primary",children:be[a.type]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-brand-text-primary",children:a.summary}),e.jsxs("p",{className:"text-xs text-brand-text-muted",children:[new Date(a.date).toLocaleString("es-AR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})," por ",e.jsx("span",{className:"font-semibold",children:V.get(a.doneBy)||"N/A"})]})]})]},a.id)),m.length===0&&e.jsx("p",{className:"text-center text-sm text-brand-text-muted py-8",children:"No hay interacciones registradas."})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-black/20 border-t border-brand-border flex justify-between items-center",children:[e.jsx("div",{children:_&&e.jsx("button",{type:"button",onClick:$,disabled:f,className:"px-4 py-2 text-sm font-medium text-black bg-brand-accent border border-transparent rounded-md shadow-sm hover:bg-brand-accent-hover disabled:opacity-50",children:f?"Convirtiendo...":"Convertir a Socio"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:T,className:"px-4 py-2 text-sm font-medium text-brand-text-primary bg-brand-border border border-transparent rounded-md shadow-sm hover:bg-gray-600",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:O,disabled:f,className:"px-4 py-2 text-sm font-medium text-white bg-brand-primary border border-transparent rounded-md shadow-sm hover:bg-brand-primary-hover disabled:opacity-50",children:f?"Guardando...":"Guardar Cambios"})]})]})]})})},Me=["documento","nombre","apellido","email","celular","direccion","fecha de inactivacion","plan","motivo"],De=["nombre","apellido","email"],Fe=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M12 15l-4-4m0 0l4-4m-4 4h12"})}),Pe=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),xe=()=>e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),Te=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),Ee=({isOpen:p,onClose:T,onSuccess:A,sellers:M})=>{const{user:l}=K(),[s,r]=n.useState(1),[x,u]=n.useState([]),[R,f]=n.useState(""),[F,m]=n.useState(null),[P,o]=n.useState(null),[y,C]=n.useState({}),[E,V]=n.useState([]),[i,w]=n.useState(!1),[g,O]=n.useState(0),[W,$]=n.useState(ce.Bajas),Z=n.useCallback(()=>{r(1),u([]),f(""),m(null),o(null),C({}),V([]),w(!1),O(0),$(ce.Bajas)},[]),_=()=>{Z(),T()},G=d=>{m(null),f(d.name);const v=new FileReader;v.onload=S=>{var k;try{const t=new Uint8Array((k=S.target)==null?void 0:k.result),b=XLSX.read(t,{type:"array",cellDates:!0}),j=b.SheetNames[0],X=b.Sheets[j],I=XLSX.utils.sheet_to_json(X,{header:1})[0]||[];if(I.length===0){m("El archivo está vacío o la primera fila (cabeceras) está en blanco.");return}const J=I.map(z=>String(z).toLowerCase().trim().replace(/\s+/g," ")),q=De.filter(z=>!J.includes(z));if(q.length>0){m(`Faltan las siguientes columnas obligatorias: ${q.join(", ")}.`);return}const he=XLSX.utils.sheet_to_json(X).map(z=>{const de={};return Object.keys(z).forEach(le=>{const ie=le.toLowerCase().trim().replace(/\s+/g," ");Me.includes(ie)&&(de[ie]=z[le])}),de}).filter(z=>z.nombre&&z.apellido&&z.email);u(he),r(2)}catch(t){console.error(t),m("Error al procesar el archivo. Asegúrate de que es un formato válido (.xlsx, .csv).")}},v.readAsArrayBuffer(d)},a=d=>d.preventDefault(),N=d=>{d.preventDefault(),d.dataTransfer.files&&d.dataTransfer.files[0]&&G(d.dataTransfer.files[0])},D=d=>{d.target.files&&d.target.files[0]&&G(d.target.files[0])},L=()=>{const S=[["Documento","Nombre","Apellido","Email","Celular","Direccion","Fecha de inactivacion","Plan","Motivo"],...[["12345678","Juan","Perez","juan.p@example.com","1122334455","Calle Falsa 123, CABA","31/12/2025","Total Anual 1 pago","Se mudó"],["87654321","Maria","Gomez","maria.g@example.com","1199887766","Av. Siempreviva 742","","Flex","Motivos personales"]]],k=XLSX.utils.aoa_to_sheet(S);k["!cols"]=[{wch:15},{wch:20},{wch:20},{wch:30},{wch:15},{wch:30},{wch:20},{wch:25},{wch:30}];const t=XLSX.utils.book_new();XLSX.utils.book_append_sheet(t,k,"Plantilla"),XLSX.writeFile(t,"plantilla_importacion_prospectos.xlsx")},ee=(d,v)=>{C(S=>({...S,[d]:v}))},re=d=>{V(v=>v.includes(d)?v.filter(S=>S!==d):[...v,d])},te=n.useMemo(()=>x.length>0&&Object.keys(y).length===x.length,[x,y]),Y=async()=>{if(!l)return;w(!0);let d=[];const v=new Date;v.setDate(v.getDate()+1);const S=Object.values(h),k=t=>{let b="";const j=t["fecha de inactivacion"];j&&(j instanceof Date?b=`Fecha de inactivación: ${j.toLocaleDateString("es-AR")}. `:b=`Fecha de inactivación: ${j}. `);const X=`${b}${t.motivo||"Importado desde archivo."}`,I=S.find(J=>{var q;return J.toLowerCase()===((q=t.plan)==null?void 0:q.toLowerCase())})||h.Flex;return{name:`${t.nombre||""} ${t.apellido||""}`.trim(),email:t.email,dni:String(t.documento||""),phone:String(t.celular||""),source:W,interest:I,stage:H.New,address:t.direccion||"",notes:X,createdBy:l.id,updatedBy:l.id,nextActionDate:v.toISOString()}};P==="random"?d=x.map((t,b)=>({...k(t),assignedTo:E[b%E.length]})):P==="manual"&&(d=x.map((t,b)=>({...k(t),assignedTo:y[b]})));try{await Promise.all(d.map(t=>B.addProspect(t))),O(d.length),r(5)}catch(t){console.error("Failed to import prospects",t),m("Ocurrió un error al guardar los prospectos. Por favor, inténtelo de nuevo.")}finally{w(!1)}};return p?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"bg-brand-surface border border-brand-border rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col m-4",children:[e.jsxs("div",{className:"p-5 border-b border-brand-border flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-text-primary",children:"Importar Prospectos"}),e.jsx("button",{onClick:_,className:"text-gray-400 hover:text-gray-600",children:"×"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto",children:[s===1&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-900/30 border-l-4 border-blue-500 text-blue-200 rounded-r-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:"Instrucciones"}),e.jsx("p",{className:"text-sm mt-1",children:"Prepara tu archivo .xlsx o .csv. Las columnas 'Nombre', 'Apellido' y 'Email' son obligatorias."})]}),e.jsxs("button",{type:"button",onClick:L,className:"flex items-center px-3 py-2 text-sm font-medium text-black bg-brand-accent rounded-md hover:bg-brand-accent-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-accent whitespace-nowrap",children:[e.jsx(Te,{}),"Descargar Plantilla"]})]}),e.jsxs("p",{className:"text-xs mt-2",children:["Columnas que se tomarán: ",e.jsx("strong",{children:"Documento, Nombre, Apellido, Email, Celular, Direccion, Fecha de inactivacion, Plan, Motivo"}),"."]})]}),e.jsxs("div",{onDragOver:a,onDrop:N,className:"border-2 border-dashed border-brand-border rounded-lg p-10 text-center cursor-pointer hover:border-brand-primary",onClick:()=>{var d;return(d=document.getElementById("file-upload"))==null?void 0:d.click()},children:[e.jsx(Fe,{}),e.jsxs("p",{className:"mt-2 text-brand-text-secondary",children:["Arrastra tu archivo aquí o ",e.jsx("span",{className:"font-semibold text-brand-primary",children:"haz clic para seleccionar"}),"."]}),e.jsx("input",{type:"file",id:"file-upload",className:"hidden",accept:".xlsx, .xls, .csv",onChange:D})]}),F&&e.jsx("p",{className:"text-red-500 text-sm mt-4",children:F})]}),s===2&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 text-brand-text-primary",children:["Archivo: ",e.jsx("span",{className:"font-normal",children:R})]}),e.jsxs("p",{className:"mb-4 text-green-400",children:["Se han encontrado ",x.length," prospectos válidos. Por favor, elige cómo quieres asignarlos."]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>{o("random"),r(3)},className:"p-6 border border-brand-border rounded-lg hover:shadow-lg hover:border-brand-primary cursor-pointer text-center",children:[e.jsx("h4",{className:"text-xl font-bold text-brand-text-primary",children:"Asignación Aleatoria"}),e.jsx("p",{className:"text-sm text-brand-text-muted mt-2",children:"Distribuye los prospectos de forma equitativa entre los vendedores que elijas."})]}),e.jsxs("div",{onClick:()=>{o("manual"),r(4)},className:"p-6 border border-brand-border rounded-lg hover:shadow-lg hover:border-brand-primary cursor-pointer text-center",children:[e.jsx("h4",{className:"text-xl font-bold text-brand-text-primary",children:"Asignación Manual"}),e.jsx("p",{className:"text-sm text-brand-text-muted mt-2",children:"Asigna cada prospecto a un vendedor específico."})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-brand-border",children:[e.jsx("label",{htmlFor:"defaultSource",className:"block text-sm font-medium text-brand-text-secondary",children:"Origen por defecto para los prospectos"}),e.jsx("select",{id:"defaultSource",value:W,onChange:d=>$(d.target.value),className:"mt-1 block w-full md:w-1/2 p-2 border border-brand-border bg-brand-surface text-brand-text-primary rounded-md shadow-sm",children:Q.map(d=>e.jsx("option",{value:d,children:d},d))})]})]}),s===3&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-brand-text-primary",children:"Asignación Aleatoria"}),e.jsx("p",{className:"text-sm text-brand-text-secondary mb-4",children:"Selecciona los vendedores que participarán en la distribución."}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto p-2 border border-brand-border rounded-md",children:M.map(d=>e.jsxs("label",{className:"flex items-center p-2 rounded-md hover:bg-white/5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:E.includes(d.id),onChange:()=>re(d.id),className:"h-4 w-4 rounded border-brand-border bg-brand-surface text-brand-primary focus:ring-brand-primary"}),e.jsx("span",{className:"ml-3 text-sm font-medium text-brand-text-primary",children:d.name})]},d.id))})]}),s===4&&e.jsxs("div",{className:"max-h-[60vh] overflow-auto",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-brand-text-primary",children:"Asignación Manual"}),e.jsx("p",{className:"text-sm text-brand-text-secondary mb-4",children:"Asigna un vendedor a cada prospecto. El botón de importación se activará cuando todos estén asignados."}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-brand-border",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-bold text-gray-300 uppercase",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-bold text-gray-300 uppercase",children:"Apellido"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-bold text-gray-300 uppercase",children:"Email"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-bold text-gray-300 uppercase",children:"Asignar a"})]})}),e.jsx("tbody",{className:"bg-brand-surface divide-y divide-brand-border",children:x.map((d,v)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-brand-text-secondary",children:d.nombre}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-brand-text-secondary",children:d.apellido}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-brand-text-secondary",children:d.email}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.jsxs("select",{value:y[v]||"",onChange:S=>ee(v,S.target.value),className:"w-full p-1 border border-brand-border bg-brand-surface rounded-md text-brand-text-primary",children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar..."}),M.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})})]},v))})]})})]}),s===5&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx(Pe,{}),e.jsx("h3",{className:"text-2xl font-bold mt-4 text-brand-text-primary",children:"¡Importación Exitosa!"}),e.jsxs("p",{className:"text-brand-text-secondary mt-2",children:["Se han agregado ",g," nuevos prospectos al sistema."]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-black/20 border-t border-brand-border flex justify-between items-center",children:[e.jsx("div",{children:s>1&&s<5&&e.jsx("button",{onClick:()=>r(s-1),className:"px-4 py-2 text-sm font-medium text-brand-text-primary bg-brand-border border-transparent rounded-md shadow-sm hover:bg-gray-600",children:"Atrás"})}),e.jsxs("div",{children:[s<5&&e.jsx("button",{onClick:_,className:"px-4 py-2 text-sm font-medium text-brand-text-secondary",children:"Cancelar"}),s===3&&e.jsx("button",{onClick:Y,disabled:E.length===0||i,className:"ml-3 px-4 py-2 text-sm font-medium text-white bg-brand-primary rounded-md shadow-sm hover:bg-brand-primary-hover disabled:opacity-50 flex items-center",children:i?e.jsxs(e.Fragment,{children:[e.jsx(xe,{})," ",e.jsx("span",{className:"ml-2",children:"Importando..."})]}):"Importar y Asignar"}),s===4&&e.jsx("button",{onClick:Y,disabled:!te||i,className:"ml-3 px-4 py-2 text-sm font-medium text-white bg-brand-primary rounded-md shadow-sm hover:bg-brand-primary-hover disabled:opacity-50 flex items-center",children:i?e.jsxs(e.Fragment,{children:[e.jsx(xe,{})," ",e.jsx("span",{className:"ml-2",children:"Importando..."})]}):"Importar y Asignar"}),s===5&&e.jsx("button",{onClick:()=>{A(),_()},className:"px-4 py-2 text-sm font-medium text-white bg-brand-primary rounded-md shadow-sm hover:bg-brand-primary-hover",children:"Finalizar"})]})]})]})}):null},Ie=()=>e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),Le=({isOpen:p,onClose:T,onSuccess:A,sellers:M,prospectsToReassign:l})=>{const{user:s}=K(),[r,x]=n.useState("random"),[u,R]=n.useState([]),[f,F]=n.useState(""),[m,P]=n.useState(!1),[o,y]=n.useState(null);n.useEffect(()=>{p||(x("random"),R([]),F(""),P(!1),y(null))},[p]);const C=i=>{R(w=>w.includes(i)?w.filter(g=>g!==i):[...w,i])},E=async()=>{if(s){P(!0),y(null);try{const i=l.map(w=>{let g=w.assignedTo;r==="random"&&u.length>0?g=u[Math.floor(Math.random()*u.length)]:r==="single"&&f&&(g=f);const O={...w,assignedTo:g,updatedBy:s.id};return B.updateProspect(O)});await Promise.all(i),A()}catch(i){console.error("Failed to reassign prospects",i),y("Ocurrió un error al reasignar. Por favor, intente de nuevo.")}finally{P(!1)}}},V=m||r==="random"&&u.length===0||r==="single"&&!f;return p?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"bg-brand-surface border border-brand-border rounded-lg shadow-xl w-full max-w-lg m-4",children:[e.jsxs("div",{className:"p-6 border-b border-brand-border",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-text-primary",children:"Reasignar Prospectos"}),e.jsxs("p",{className:"text-sm text-brand-text-secondary",children:["Estás a punto de reasignar ",l.length," ",l.length===1?"prospecto":"prospectos","."]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-text-secondary mb-2",children:"Método de Asignación"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"assignmentMode",value:"random",checked:r==="random",onChange:()=>x("random"),className:"h-4 w-4 text-brand-primary focus:ring-brand-primary"}),e.jsx("span",{className:"ml-2 text-sm text-brand-text-primary",children:"Aleatoria"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"assignmentMode",value:"single",checked:r==="single",onChange:()=>x("single"),className:"h-4 w-4 text-brand-primary focus:ring-brand-primary"}),e.jsx("span",{className:"ml-2 text-sm text-brand-text-primary",children:"A un vendedor específico"})]})]})]}),r==="random"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-text-secondary mb-2",children:"Vendedores para distribución"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto p-3 border border-brand-border rounded-md",children:M.map(i=>e.jsxs("label",{className:"flex items-center p-2 rounded-md hover:bg-white/5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.includes(i.id),onChange:()=>C(i.id),className:"h-4 w-4 rounded border-brand-border bg-brand-surface text-brand-primary focus:ring-brand-primary"}),e.jsx("span",{className:"ml-3 text-sm font-medium text-brand-text-primary",children:i.name})]},i.id))}),u.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Selecciona al menos un vendedor."})]}),r==="single"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"singleSeller",className:"block text-sm font-medium text-brand-text-secondary",children:"Asignar todos a"}),e.jsxs("select",{id:"singleSeller",value:f,onChange:i=>F(i.target.value),className:"mt-1 block w-full bg-brand-surface border border-brand-border rounded-md shadow-sm p-2 text-brand-text-primary focus:ring-brand-primary focus:border-brand-primary",children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar vendedor..."}),M.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),!f&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Debes seleccionar un vendedor."})]}),o&&e.jsx("p",{className:"text-red-500 text-sm mt-2 text-center",children:o})]}),e.jsxs("div",{className:"px-6 py-4 bg-black/20 border-t border-brand-border flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:T,className:"px-4 py-2 text-sm font-medium text-brand-text-primary bg-brand-border border border-transparent rounded-md shadow-sm hover:bg-gray-600",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:E,disabled:V,className:"px-4 py-2 text-sm font-medium text-white bg-brand-primary border border-transparent rounded-md shadow-sm hover:bg-brand-primary-hover disabled:opacity-50 flex items-center",children:m?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{})," ",e.jsx("span",{className:"ml-2",children:"Reasignando..."})]}):"Confirmar Reasignación"})]})]})}):null},Re=n.lazy(()=>fe(()=>import("./ImportGoogleSheetModal-Dt4lVu6k.js"),__vite__mapDeps([0,1]))),Oe={[H.New]:"bg-blue-900/60 text-blue-200",[H.Contacted]:"bg-indigo-900/60 text-indigo-200",[H.Trial]:"bg-yellow-400/20 text-yellow-300",[H.Won]:"bg-green-900/60 text-green-200",[H.Lost]:"bg-red-900/60 text-red-200"},Be=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),Ve=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),_e=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("path",{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM11.5 19H8.5V17.5H11.5V19ZM11.5 16H8.5V14.5H11.5V16ZM11.5 13H8.5V11.5H11.5V13ZM15.5 19H12.5V11.5H15.5V19Z",fill:"#34A853"}),e.jsx("path",{d:"M13 9H18.5L13 3.5V9Z",fill:"#B0BEC5"})]}),ze=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),Ge=()=>{const[p,T]=n.useState([]),[A,M]=n.useState([]),[l,s]=n.useState(!0),{user:r}=K(),[x,u]=n.useState(!1),[R,f]=n.useState(!1),[F,m]=n.useState(!1),[P,o]=n.useState(!1),[y,C]=n.useState(!1),[E,V]=n.useState(null),[i,w]=n.useState([]),g=n.useMemo(()=>new Set(i),[i]),[O,W]=n.useState("all"),[$,Z]=n.useState("all"),[_,G]=n.useState("all"),a=n.useCallback(async()=>{s(!0),w([]);try{const[t,b]=await Promise.all([B.getProspects(),B.getUsers()]);T(t),M(b.filter(j=>j.role===c.Seller||j.role===c.Manager||j.role===c.Admin))}catch(t){console.error("Failed to fetch data",t)}finally{s(!1)}},[]);n.useEffect(()=>{a()},[a]);const N=n.useMemo(()=>new Map(A.map(t=>[t.id,t.name])),[A]),D=n.useMemo(()=>(r==null?void 0:r.role)===c.Admin?A.filter(t=>t.role===c.Seller):r?A.filter(t=>t.role===c.Seller&&t.branch===r.branch):[],[A,r]),L=n.useMemo(()=>{if(!r)return[];let t=[...p];r.role===c.Manager||r.role===c.Viewer?t=t.filter(I=>I.branch===r.branch):r.role===c.Seller&&(t=t.filter(I=>I.branch===r.branch&&I.assignedTo===r.id));const b=O!=="all",j=$!=="all",X=_!=="all"&&(r.role===c.Admin||r.role===c.Manager);return!b&&!j&&!X?t:t.filter(I=>{const J=!b||I.stage===O,q=!j||I.source===$,oe=!X||I.assignedTo===_;return J&&q&&oe})},[p,r,O,$,_]),ee=t=>{T(b=>[...b,t]),u(!1)},re=t=>{T(b=>b.map(j=>j.id===t.id?t:j)),f(!1),V(null)},te=t=>{(r==null?void 0:r.role)!==c.Viewer&&(V(t),f(!0))},Y=()=>{W("all"),Z("all"),G("all")},d=t=>{t.target.checked?w(L.map(b=>b.id)):w([])},v=(t,b)=>{t.stopPropagation(),t.target.checked?w(j=>[...j,b]):w(j=>j.filter(X=>X!==b))},S=()=>{C(!1),a()};if(l)return e.jsx(ae,{children:"Cargando prospectos..."});const k=(r==null?void 0:r.role)===c.Admin||(r==null?void 0:r.role)===c.Manager;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-brand-text-primary",children:"Prospectos"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[i.length>0&&k&&e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center px-4 py-2 text-sm font-medium text-black bg-brand-accent rounded-md hover:bg-brand-accent-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-accent",children:[e.jsx(ze,{}),"Reasignar (",i.length,")"]}),k&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center px-4 py-2 text-sm font-medium text-black bg-brand-accent rounded-md hover:bg-brand-accent-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-accent",children:[e.jsx(_e,{}),"Importar desde Google Sheet"]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center px-4 py-2 text-sm font-medium text-brand-text-primary bg-brand-border rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:[e.jsx(Ve,{}),"Importar Bajas (Excel)"]})]}),(k||(r==null?void 0:r.role)===c.Seller)&&e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-brand-primary rounded-md hover:bg-brand-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-primary",children:[e.jsx(Be,{}),"Agregar Prospecto"]})]})]}),e.jsx(ae,{className:"mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stageFilter",className:"block text-sm font-medium text-brand-text-secondary",children:"Etapa"}),e.jsxs("select",{id:"stageFilter",value:O,onChange:t=>W(t.target.value),className:"mt-1 block w-full p-2 border border-brand-border bg-brand-surface text-brand-text-primary rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary",children:[e.jsx("option",{value:"all",children:"Todas"}),ne.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sourceFilter",className:"block text-sm font-medium text-brand-text-secondary",children:"Origen"}),e.jsxs("select",{id:"sourceFilter",value:$,onChange:t=>Z(t.target.value),className:"mt-1 block w-full p-2 border border-brand-border bg-brand-surface text-brand-text-primary rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary",children:[e.jsx("option",{value:"all",children:"Todos"}),Q.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),k&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sellerFilter",className:"block text-sm font-medium text-brand-text-secondary",children:"Vendedor"}),e.jsxs("select",{id:"sellerFilter",value:_,onChange:t=>G(t.target.value),className:"mt-1 block w-full p-2 border border-brand-border bg-brand-surface text-brand-text-primary rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary",children:[e.jsx("option",{value:"all",children:"Todos"}),D.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx("div",{children:e.jsx("button",{onClick:Y,className:"w-full px-4 py-2 text-sm font-medium text-brand-text-primary bg-brand-border rounded-md shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-primary",children:"Limpiar Filtros"})})]})}),e.jsxs(ae,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-brand-border",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[k&&e.jsx("th",{scope:"col",className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-brand-border bg-brand-surface text-brand-primary focus:ring-brand-primary",checked:!l&&L.length>0&&i.length===L.length,onChange:d})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider",children:"Etapa"}),(r==null?void 0:r.role)===c.Admin&&e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider",children:"Sucursal"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider",children:"Interés"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider",children:"Próxima Acción"}),k&&e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider",children:"Asignado a"})]})}),e.jsx("tbody",{className:"bg-brand-surface divide-y divide-brand-border",children:L.map(t=>e.jsxs("tr",{onClick:()=>te(t),className:`hover:bg-white/5 ${(r==null?void 0:r.role)!==c.Viewer?"cursor-pointer":""}`,children:[k&&e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-brand-border bg-brand-surface text-brand-primary focus:ring-brand-primary",checked:i.includes(t.id),onChange:b=>v(b,t.id),onClick:b=>b.stopPropagation()})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-brand-text-primary",children:t.name}),e.jsx("div",{className:"text-xs text-brand-text-muted",children:t.email})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${Oe[t.stage]||"bg-gray-700 text-gray-200"}`,children:t.stage})}),(r==null?void 0:r.role)===c.Admin&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-brand-text-secondary",children:t.branch}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-brand-text-secondary",children:t.interest}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-brand-text-secondary",children:t.nextActionDate?new Date(t.nextActionDate).toLocaleDateString("es-AR"):"N/A"}),k&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-brand-text-secondary",children:N.get(t.assignedTo)||"N/A"})]},t.id))})]})}),L.length===0&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx("h3",{className:"text-xl font-semibold text-brand-text-secondary",children:"No se encontraron prospectos"}),e.jsx("p",{className:"text-brand-text-muted mt-2",children:"Intenta ajustar los filtros o agrega un nuevo prospecto."})]})]}),e.jsx(ye,{isOpen:x,onClose:()=>u(!1),onSuccess:ee,sellers:D}),e.jsx(Ae,{isOpen:R,onClose:()=>{f(!1),V(null)},onSuccess:re,users:A,prospect:E}),e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Re,{isOpen:P,onClose:()=>o(!1),onSuccess:()=>{o(!1),a()},sellers:D})}),e.jsx(Ee,{isOpen:F,onClose:()=>m(!1),onSuccess:()=>{m(!1),a()},sellers:D}),e.jsx(Le,{isOpen:y,onClose:()=>C(!1),onSuccess:S,sellers:D,prospectsToReassign:p.filter(t=>g.has(t.id))})]})};export{Ge as default};
